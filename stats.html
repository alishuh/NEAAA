<!doctype html>
<html>
<head>
    <title>Spotify Statistics</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>
<body>
    <header>
        <h1>Spotistats</h1>
    </header>

    <nav>
        <a href="/home.html">Home</a>
        <a class="selectedPage" href="/stats.html">Statistics Viewer</a>
        <a href="/recommendations.html">Recommendations</a>
        <a href="/quiz.html">Quiz</a>
        <a href="#" class="right">Log Out</a>
        <div id="userLoggedInMessage"></div> <!--shows 'logged in as [user's name]' next to logout button]-->
    </nav>

    <h1>View your Listening Statistics!</h1>

    <section class="statsViewingOptions">

        <h3>Choose The Options</h3><br />

        <form name="statsOptionsForm" onsubmit="validate();">
            <label class="darkRedText" id="type">
                <b>Statistics for Artists or Songs?</b> <br />
                <label class="input"> <input type="radio" name="type" id="artists" /> Artists </label>
                <label class="input"> <input type="radio" name="type" id="tracks" /> Songs </label>
            </label><br /><br />

            <label class="darkRedText" id="amount">
                <b>How Many Results?</b> <br />
                <input value="10" type="text" id="numberOfItems" placeholder="1 - 50" class="input"> <br><br>
            </label>

            <label class="darkRedText" id="time">
                <b> Period for Results?</b> <br />
                <label class="input"> <input type="radio" name="time" id="long_term" /> Forever </label>
                <label class="input"> <input type="radio" name="time" id="medium_term" /> Past 6 Months </label>
                <label class="input"> <input type="radio" name="time" id="short_term" /> Past Month </label> <br />
            </label> <br />

            <button type="submit" class="btn">Show my stats</button>
            <div id="inputError" class="errorText"></div> <br /><br />
        </form>

    </section> <br /><br />

    <section>
        
        <table id="topItemsTable" class="itemsTable"></table>
    
    </section>


    <script src="/functions.js"></script>
    <script>
        async function validate() {
            event.preventDefault();
            let inputType = document.querySelector('input[name="type"]:checked');
            let inputTime = document.querySelector('input[name="time"]:checked');
            let input = document.getElementById('numberOfItems');
            let inputValue = input.value;
            let inputError = document.getElementById('inputError');

            if ((!inputType) || (!inputTime)) {
                inputError.innerHTML = 'You must select the options first!';
            }
            else if ((inputValue < 1) || (inputValue > 50) || (isNaN(inputValue))) {
                inputError.innerHTML = 'The Number of Results must be a number between 1-50!';
            }
            else {
                inputError.innerHTML = '';
                let data = await getTopItems(inputType.id, inputValue, inputTime.id);
                displayTopItems(data, inputType.id);
            }
        }

        function displayTopItems(data, type) {
            let itemsList = document.getElementById('topItemsTable');
            itemsList.innerHTML = '';

            let items = data.items;

            if (type == 'tracks') {
                itemsList.innerHTML += `<tr> <th>Songs</th> <th>Artists</th></tr>`;
                for (let i = 0; i < items.length; i++) {
                    let item = items[i];
                    itemsList.innerHTML += `<tr><td class="item">${item.name}</td> <td class="description">${item.artists[0].name}</td></tr>`;
                }
            }
            else if (type == 'artists') {
                itemsList.innerHTML += `<tr> <th>Artists</th></tr>`;
                for (let i = 0; i < items.length; i++) {
                    let item = items[i];
                    itemsList.innerHTML += `<tr> <td class="item">${item.name}</td> </tr>`;
                }
            }
            
        }

    </script>









</body>
</html>